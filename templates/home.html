<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>La_Verita</title>
  </head>
  <script>
  window.onload = function () {
    async function fetchData() {
      const data = await fetch('http://127.0.0.1:5000/api/analyze',{
          method:'GET',})
  
      const filteredData = await data.json();
      data_pos = []
      data_neg = []
      data_neu = []
      for(let i=0; i < (filteredData['positive'][0].length); i++){
        data_pos.push({x:new Date(filteredData['positive'][1][i]), y:filteredData['positive'][0][i]})
      }
      for(let i=0; i < (filteredData['negative'][0].length); i++){
        data_neg.push({x:new Date(filteredData['negative'][1][i]), y:filteredData['negative'][0][i]})
      }
      for(let i=0; i < (filteredData['neutral'][0].length); i++){
        data_neu.push({x:new Date(filteredData['neutral'][1][i]), y:filteredData['neutral'][0][i]})
      }
      var chart = new CanvasJS.Chart("chartContainer", {
      title: {
        text: "Tweet base on timeline"
      },
      axisX: {
        valueFormatString: "MMM YYYY"
      },
      axisY2: {
        title: "Tweet",
        suffix: "Tweets"
      },
      toolTip: {
        shared: true
      },
      legend: {
        cursor: "pointer",
        verticalAlign: "top",
        horizontalAlign: "center",
        dockInsidePlotArea: true,
        itemclick: toogleDataSeries
      },
      data: [{
        type:"line",
        axisYType: "secondary",
        name: "Positive",
        showInLegend: true,
        markerSize: 0,
        yValueFormatString: "#,### Tweets",
        dataPoints: data_pos
      },
      {
        type: "line",
        axisYType: "secondary",
        name: "Negative",
        showInLegend: true,
        markerSize: 0,
        yValueFormatString: "#,### Tweets",
        dataPoints: data_neg
      },
      {
        type: "line",
        axisYType: "secondary",
        name: "Neutral",
        showInLegend: true,
        markerSize: 0,
        yValueFormatString: "#,### Tweets",
        dataPoints: data_neu
      },
      ]
    });
    chart.render();

    function toogleDataSeries(e){
      if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
        e.dataSeries.visible = false;
      } else{
        e.dataSeries.visible = true;
      }
      chart.render();
    }
  }
  fetchData()

} 
  </script>
  <body>
    <form action="{{ url_for("home")}}" method="post">
        <label for="inputtext">Input Text:</label>
        <input type="text" id="inputtext" name="inputText" placeholder="text">
        <button type="submit">Analysis</button>
        <div id="chartContainer" style="height: 370px; max-width: 920px; margin: 0px auto;"></div>
        <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
  </body>
</html>